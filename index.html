<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Data Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .table {
            margin-bottom: 0;
        }
        .table thead th {
            background-color: #495057;
            color: white;
            border: none;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        .filter-input {
            margin-bottom: 1rem;
        }
        .btn-download {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        .btn-clear {
            background: linear-gradient(135deg, #dc3545 0%, #fd7e14 100%);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        .loading {
            text-align: center;
            padding: 2rem;
        }
        .no-data {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-bar"></i> CSV Data Dashboard</h1>
            <p class="mb-0">Dynamic Data Filtering and Export Tool</p>
        </div>

        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-number" id="totalRecords">0</div>
                    <div>Total Records</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-number" id="filteredRecords">0</div>
                    <div>Filtered Records</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stats-card">
                    <div class="stats-number" id="columnsCount">0</div>
                    <div>Columns</div>
                </div>
            </div>
        </div>

        <div class="filter-section">
            <div class="row mb-3">
                <div class="col-md-6">
                    <h4><i class="fas fa-filter"></i> Filters</h4>
                </div>
                <div class="col-md-6 text-end">
                    <label class="btn btn-outline-primary">
                        <i class="fas fa-upload"></i> Load CSV File
                        <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                    </label>
                </div>
            </div>
            <div id="filterContainer" class="row">
                <!-- Dynamic filters will be generated here -->
            </div>
            <div class="mt-3">
                <button class="btn btn-clear me-2" id="clearFilters">
                    <i class="fas fa-times"></i> Clear All Filters
                </button>
                <button class="btn btn-download" id="downloadFiltered">
                    <i class="fas fa-download"></i> Download Filtered Data
                </button>
            </div>
        </div>

        <div class="table-container">
            <div id="loading" class="loading">
                <i class="fas fa-spinner fa-spin fa-2x"></i>
                <p>Loading data...</p>
            </div>
            <div id="tableContainer" style="display: none;">
                <table class="table table-striped" id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <div id="noData" class="no-data" style="display: none;">
                <i class="fas fa-exclamation-circle fa-2x mb-3"></i>
                <p>No data matches your current filters.</p>
            </div>
        </div>
    </div>

    <script>
        let csvData = [];
        let filteredData = [];
        let headers = [];

        $(document).ready(function() {
            loadCSVData();
        });

        function loadCSVData() {
            // Embedded CSV data to avoid CORS issues
            const csvDataString = `ID,Name,Department,Position,Salary,Start_Date,Email,Status
1,John Smith,Engineering,Software Developer,75000,2023-01-15,john.smith@company.com,Active
2,Sarah Johnson,Marketing,Marketing Manager,68000,2022-08-20,sarah.johnson@company.com,Active
3,Michael Brown,Finance,Financial Analyst,62000,2023-03-10,michael.brown@company.com,On Leave
4,Emily Davis,Human Resources,HR Specialist,58000,2022-11-05,emily.davis@company.com,Active
5,David Wilson,Engineering,Senior Developer,85000,2021-06-12,david.wilson@company.com,Active
6,Lisa Anderson,Sales,Sales Representative,55000,2023-02-28,lisa.anderson@company.com,Inactive
7,Robert Miller,IT,System Administrator,70000,2022-12-01,robert.miller@company.com,Active
8,Jennifer Garcia,Marketing,Content Creator,52000,2023-04-18,jennifer.garcia@company.com,Active
9,William Martinez,Finance,Accountant,60000,2022-09-15,william.martinez@company.com,On Leave
10,Amanda Taylor,Engineering,QA Engineer,65000,2023-01-08,amanda.taylor@company.com,Active`;

            try {
                parseCSV(csvDataString);
                createFilterInputs();
                displayData(csvData);
                updateStats();
                $('#loading').hide();
                $('#tableContainer').show();
            } catch (error) {
                $('#loading').html('<div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> Error processing CSV data: ' + error.message + '</div>');
            }
        }

        function parseCSV(data) {
            const lines = data.split('\n').filter(line => line.trim() !== '');
            headers = lines[0].split(',').map(header => header.trim());
            
            csvData = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim());
                if (values.length === headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    csvData.push(row);
                }
            }
            filteredData = [...csvData];
        }

        function createFilterInputs() {
            const filterContainer = $('#filterContainer');
            filterContainer.empty();

            headers.forEach(header => {
                const uniqueValues = [...new Set(csvData.map(row => row[header]))].sort();
                
                const filterDiv = $(`
                    <div class="col-md-6 col-lg-4 filter-input">
                        <label class="form-label fw-bold">${header}</label>
                        <select class="form-select filter-select" data-column="${header}">
                            <option value="">All ${header}s</option>
                        </select>
                    </div>
                `);

                const select = filterDiv.find('select');
                uniqueValues.forEach(value => {
                    select.append(`<option value="${value}">${value}</option>`);
                });

                filterContainer.append(filterDiv);
            });

            // Add event listener for filter changes
            $('.filter-select').on('change', applyFilters);
        }

        function applyFilters() {
            filteredData = csvData.filter(row => {
                return $('.filter-select').toArray().every(select => {
                    const column = $(select).data('column');
                    const value = $(select).val();
                    return !value || row[column] === value;
                });
            });

            displayData(filteredData);
            updateStats();
        }

        function displayData(data) {
            const tableHead = $('#tableHead');
            const tableBody = $('#tableBody');

            // Clear existing content
            tableHead.empty();
            tableBody.empty();

            if (data.length === 0) {
                $('#tableContainer').hide();
                $('#noData').show();
                return;
            }

            $('#noData').hide();
            $('#tableContainer').show();

            // Create header row
            const headerRow = $('<tr></tr>');
            headers.forEach(header => {
                headerRow.append(`<th>${header}</th>`);
            });
            tableHead.append(headerRow);

            // Create data rows
            data.forEach(row => {
                const dataRow = $('<tr></tr>');
                headers.forEach(header => {
                    dataRow.append(`<td>${row[header] || ''}</td>`);
                });
                tableBody.append(dataRow);
            });
        }

        function updateStats() {
            $('#totalRecords').text(csvData.length);
            $('#filteredRecords').text(filteredData.length);
            $('#columnsCount').text(headers.length);
        }

        function downloadCSV(data, filename) {
            if (data.length === 0) {
                alert('No data to download!');
                return;
            }

            // Create CSV content
            let csvContent = headers.join(',') + '\n';
            data.forEach(row => {
                const values = headers.map(header => {
                    let value = row[header] || '';
                    // Escape quotes and wrap in quotes if necessary
                    if (value.includes(',') || value.includes('"') || value.includes('\n')) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                csvContent += values.join(',') + '\n';
            });

            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Event handlers
        $('#downloadFiltered').on('click', function() {
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            downloadCSV(filteredData, `filtered_data_${timestamp}.csv`);
        });

        $('#clearFilters').on('click', function() {
            $('.filter-select').val('');
            filteredData = [...csvData];
            displayData(filteredData);
            updateStats();
        });

        // File upload handler
        $('#csvFileInput').on('change', function(event) {
            const file = event.target.files[0];
            if (file && file.type === 'text/csv') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        $('#loading').show();
                        $('#tableContainer').hide();
                        parseCSV(e.target.result);
                        createFilterInputs();
                        displayData(csvData);
                        updateStats();
                        $('#loading').hide();
                        $('#tableContainer').show();
                    } catch (error) {
                        $('#loading').html('<div class="alert alert-danger"><i class="fas fa-exclamation-triangle"></i> Error processing uploaded CSV: ' + error.message + '</div>');
                    }
                };
                reader.readAsText(file);
            } else {
                alert('Please select a valid CSV file.');
            }
        });
    </script>
</body>
</html>
